{"version":3,"sources":["../../src/api/homes.js"],"names":["require","nanoId","config","api","use","jwtAuth","wrap","fn","catch","post","req","res","AccountId","account","id","Home","findOne","where","home","status","json","message","success","create","console","error","get","HomeItem","findAll","HomeId","include","model","Item","homeItems","ean","body","length","item","dataVersion","kassalClient","response","data","products","product","categories","category","map","name","join","destroy","image","external_id","brand","description","vendor","ItemId","existingHomeItem","homeItem","find","exactMatchHomeItem","similarItems","currentItem","Promise","all","items","filter","similarItem","split","some","includes"],"mappings":"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","file":"homes.js","sourcesContent":["'use strict';\nrequire('babel-polyfill');\nconst nanoId = require('nanoid');\nimport { Account, Home, Item, HomeItem } from '../models';\nimport { jwtAuth } from '../jwt';\nimport { Router } from 'express';\n\nexport default ({ config }) => {\n    let api = Router().use(jwtAuth);\n\n    let wrap = fn => (...args) => fn(...args).catch(args[2]);\n\n    api.post('/create', wrap(async (req, res) => {\n        const AccountId = req.account.id;  // Extract AccountId from token\n\n        try {\n            // Check if a Home already exists for the given AccountId\n            const home = await Home.findOne({ where: { AccountId } });\n            if (home) {\n                res.status(409).json({ message: 'Home already exists.', success: false });\n            } else {\n                // Create a new Home with the AccountId extracted from the token\n                await Home.create({ AccountId });\n                res.status(201).json({ message: 'Home created.', success: true });\n            }\n        } catch (error) {\n            console.error('Error creating home:', error);\n            res.status(500).json({ message: 'Internal server error.', success: false });\n        }\n    }));\n\n    api.get('/', wrap(async (req, res) => {\n        const AccountId = req.account.id;  // Extract AccountId from the JWT\n\n        try {\n            // Fetch the Home associated with the AccountId\n            const home = await Home.findOne({ where: { AccountId } });\n            if (home) {\n                // If a home exists, fetch all related HomeItems and their corresponding Items\n                let homeItems = await HomeItem.findAll({\n                    where: { HomeId: home.id }, // Assuming homeId is the correct column name\n                    include: [{ model: Item }] // Ensure Item is associated in your model definitions\n                });\n                res.json({ home, homeItems, success: true });\n            } else {\n                res.status(204).json({ message: 'Home not found.', success: false });\n            }\n        } catch (error) {\n            console.error('Error fetching home:', error);\n            res.status(500).json({ message: 'Internal server error.', success: false });\n        }\n    }));\n\n    api.post('/add-item', wrap(async (req, res) => {\n        const { ean } = req.body;\n        try {\n            if (ean.length !== 13 && ean.length !== 8) {\n                res.status(500).json({ message: 'Invalid EAN.', success: false });\n                return;\n            }\n\n            let item = await Item.findOne({ where: { ean } });\n\n            if (!item || item.dataVersion !== config.dataVersion) {\n                const response = await config.kassalClient.get(`/api/v1/products/ean/${ean}`);\n                const data = response && response.data && response.data.data || null;\n                if (data && data.products && data.products.length > 0) {\n                    const product = data.products[0];\n                    let categories = \"\"\n                    if (product.category && product.category.length > 0) {\n                        categories = product.category.map(category => category.name).join(',');\n                    }\n                    if (item && item.dataVersion !== config.dataVersion) {\n                        await Item.destroy({ where: { ean } });\n                    }\n                    item = await Item.create({\n                        ean,\n                        name: product.name,\n                        image: product.image,\n                        external_id: product.id,\n                        brand: product.brand,\n                        description: product.description,\n                        vendor: product.vendor,\n                        categories,\n                        dataVersion: config.dataVersion\n                    });\n                }\n            }\n\n            // Assuming a single home per account\n            const home = await Home.findOne({ where: { AccountId: req.account.id } });\n            if (home && item) {\n                const existingHomeItem = await HomeItem.findOne({ where: { HomeId: home.id, ItemId: item.id } });\n                if (existingHomeItem) {\n                    res.status(409).json({ message: 'Item already exists in home.', success: false });\n                } else {\n                    await HomeItem.create({ HomeId: home.id, ItemId: item.id });\n                    res.status(200).json({ message: 'Item added to home.', success: true });\n                }\n            } else {\n                res.status(204).json({ message: 'Home not found.', success: false });\n            }\n        } catch (error) {\n            console.error('Error adding item to home:', error);\n            res.status(500).json({ message: 'Internal server error.', success: false });\n        }\n    }));\n\n\n    api.post('/remove-item', wrap(async (req, res) => {\n        const { ean } = req.body;\n\n        try {\n            if (ean.length !== 13 && ean.length !== 8) {\n                res.status(500).json({ message: 'Invalid EAN.', success: false });\n                return;\n            }\n\n            const item = await Item.findOne({ where: { ean } });\n            if (!item) {\n                res.status(204).json({ message: 'Item not found.', success: false });\n                return;\n            }\n\n            // Assuming a single home per account\n            const home = await Home.findOne({ where: { AccountId: req.account.id } });\n            if (!home) {\n                res.status(204).json({ message: 'Home not found.', success: false });\n                return;\n            }\n\n            // Check if the item exists in the home\n            const existingHomeItem = await HomeItem.findOne({ where: { HomeId: home.id, ItemId: item.id } });\n            if (!existingHomeItem) {\n                res.status(204).json({ message: 'Item not found in home.', success: false });\n                return;\n            }\n\n            // Remove the item from the home\n            await HomeItem.destroy({ where: { id: existingHomeItem.id } });\n            res.status(200).json({ message: 'Item removed from home.', success: true });\n\n        } catch (error) {\n            console.error('Error removing item from home:', error);\n            res.status(500).json({ message: 'Internal server error.', success: false });\n        }\n    }));\n\n\n    api.post('/check-item', wrap(async (req, res) => {\n        const { ean } = req.body;\n\n        try {\n            if (ean.length !== 13 && ean.length !== 8) {\n                res.status(500).json({ message: 'Invalid EAN.', success: false });\n                return;\n            }\n\n            let item = await Item.findOne({ where: { ean } });\n            if (!item || item.dataVersion !== config.dataVersion) {\n                const response = await config.kassalClient.get(`/api/v1/products/ean/${ean}`);\n                const data = response && response.data && response.data.data || null;\n                if (data && data.products && data.products.length > 0) {\n                    const product = data.products[0];\n                    const categories = product.category.map(category => category.name).join(',');\n                    if (item && item.dataVersion !== config.dataVersion) {\n                        await Item.destroy({ where: { ean } });\n                    }\n                    item = await Item.create({\n                        ean,\n                        name: product.name,\n                        image: product.image,\n                        external_id: product.id,\n                        brand: product.brand,\n                        description: product.description,\n                        vendor: product.vendor,\n                        categories,\n                        dataVersion: config.dataVersion\n                    });\n                }\n            }\n\n            if (item) {\n                // Assuming a single home per account\n                const home = await Home.findOne({ where: { AccountId: req.account.id } });\n                if (home) {\n                    const homeItems = await HomeItem.findAll({\n                        where: { HomeId: home.id }, // Assuming homeId is the correct column name\n                        include: [{ model: Item }] // Ensure Item is associated in your model definitions\n                    });\n                    const homeItem = homeItems.find(homeItem => homeItem.ItemId === item.id);\n                    let response = { message: '', exactMatchHomeItem: null, similarItems: [], currentItem: item, success: true };\n                    if (homeItem) {\n                        response.message = 'Item is in home.';\n                        response.exactMatchHomeItem = homeItem;\n                    } else {\n                        response.message = 'Item is not in home.';\n                    }\n                    const items = await Promise.all(homeItems.map(async homeItem => {\n                        return await Item.findOne({ where: { id: homeItem.ItemId } });\n                    }));\n                    let similarItems = items.filter(similarItem => similarItem.categories.split(',').some(category => item.categories.split(',').includes(category)));\n                    response.similarItems = similarItems.filter(similarItem => similarItem.ean !== item.ean);\n                    if (response.similarItems.length > 0) {\n                        response.message = 'Item is not in home, but similar items were found.';\n                    }\n                    res.status(200).json(response);\n                } else {\n                    res.status(204).json({ message: 'Home not found.', success: false });\n                }\n            } else {\n                res.status(204).json({ message: 'Item not found.', success: false });\n            }\n        } catch (error) {\n            console.error('Error checking item in home:', error);\n            res.status(500).json({ message: 'Internal server error.', success: false });\n        }\n    }));\n\n\n    return api;\n};\n"]}